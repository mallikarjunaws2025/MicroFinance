@model IEnumerable<TestApp.DB.Staff>

@{
    Layout = "~/Views/Shared/_LayoutPage_New.cshtml";
    ViewBag.Title = "Staff Management";
}

@section Styles {
    <style>
        .modern-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8f9ff 100%);
            border: none;
            border-radius: 1rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .modern-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: center;
            border: none;
            transition: transform 0.3s ease;
        }

        .stats-card:hover {
            transform: scale(1.05);
        }

        .table-actions {
            min-width: 140px;
        }
        
        .btn-action {
            padding: 0.375rem;
            font-size: 0.875rem;
            border-radius: 0.5rem;
            transition: all 0.15s ease-in-out;
            margin: 0 2px;
            width: 35px;
            height: 35px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .staff-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
            margin-right: 12px;
        }

        .status-badge {
            font-size: 0.75rem;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-weight: 600;
        }

        .search-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            color: white;
        }

        .search-input {
            border: none;
            border-radius: 0.75rem;
            padding: 0.75rem 1rem;
            background: rgba(255,255,255,0.1);
            color: white;
            backdrop-filter: blur(10px);
        }

        .search-input::placeholder {
            color: rgba(255,255,255,0.7);
        }

        .search-input:focus {
            background: rgba(255,255,255,0.2);
            color: white;
            box-shadow: 0 0 0 0.25rem rgba(255,255,255,0.25);
        }

        .table-container {
            background: white;
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .table-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }

        .table-striped > tbody > tr:nth-of-type(odd) > td {
            background-color: rgba(102, 126, 234, 0.02);
        }

        .table > tbody > tr {
            transition: all 0.3s ease;
        }

        .table > tbody > tr:hover {
            background-color: rgba(102, 126, 234, 0.05) !important;
            transform: scale(1.01);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 0.5rem 0.5rem 0 0;
        }

        .floating-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            font-size: 24px;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .floating-btn:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.6);
        }
    </style>
}

<div class="container-fluid px-4">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h3 mb-0 text-gray-800">
                        <i class="fas fa-users-cog text-primary me-2"></i>Staff Management
                    </h1>
                    <p class="text-muted mb-0">Manage staff members, roles, and permissions</p>
                </div>
                <div class="d-flex gap-2">
                    <button type="button" class="btn btn-outline-primary" onclick="exportToExcel()">
                        <i class="fas fa-file-excel me-1"></i>Export
                    </button>
                    <button type="button" class="btn btn-outline-secondary" onclick="printTable()">
                        <i class="fas fa-print me-1"></i>Print
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Section -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="stats-card">
                <div class="h3 mb-1" id="totalStaff">@totalStaff</div>
                <div class="small">Total Staff</div>
                <i class="fas fa-users fa-2x mt-2 opacity-75"></i>
            </div>
        </div>
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="stats-card" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
                <div class="h3 mb-1" id="activeStaff">@activeStaff</div>
                <div class="small">Active Staff</div>
                <i class="fas fa-user-check fa-2x mt-2 opacity-75"></i>
            </div>
        </div>
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="stats-card" style="background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);">
                <div class="h3 mb-1" id="inactiveStaff">@inactiveStaff</div>
                <div class="small">Inactive Staff</div>
                <i class="fas fa-user-times fa-2x mt-2 opacity-75"></i>
            </div>
        </div>
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="stats-card" style="background: linear-gradient(135deg, #17a2b8 0%, #6610f2 100%);">
                <div class="h3 mb-1" id="recentJoined">@totalStaff</div>
                <div class="small">Recent Joiners</div>
                <i class="fas fa-user-plus fa-2x mt-2 opacity-75"></i>
            </div>
        </div>
    </div>

    <!-- Search and Filter Section -->
    <div class="search-section">
        <div class="row g-3 align-items-end">
            <div class="col-md-6">
                <label class="form-label fw-semibold">Search Staff</label>
                <div class="input-group">
                    <span class="input-group-text bg-transparent border-0 text-white">
                        <i class="fas fa-search"></i>
                    </span>
                    <input type="text" class="form-control search-input border-0" id="searchInput" 
                           placeholder="Search by name, ID, or status..." />
                </div>
            </div>
            <div class="col-md-3">
                <label class="form-label fw-semibold">Filter by Status</label>
                <select class="form-select search-input border-0" id="statusFilter">
                    <option value="">All Status</option>
                    <option value="Active">Active</option>
                    <option value="Inactive">Inactive</option>
                    <option value="Pending">Pending</option>
                </select>
            </div>
            <div class="col-md-3">
                <div class="d-grid">
                    <button type="button" class="btn btn-light" onclick="clearFilters()">
                        <i class="fas fa-times me-1"></i>Clear Filters
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Staff Table -->
    <div class="modern-card">
        <div class="card-header table-header border-0">
            <div class="d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">
                    <i class="fas fa-list me-2"></i>Staff Directory
                    <span class="badge bg-light text-primary ms-2" id="recordCount">@totalStaff records</span>
                </h5>
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-light btn-sm" onclick="selectAll()">
                        <i class="fas fa-check-square me-1"></i>Select All
                    </button>
                    <button type="button" class="btn btn-light btn-sm" onclick="bulkActions()">
                        <i class="fas fa-tasks me-1"></i>Bulk Actions
                    </button>
                </div>
            </div>
        </div>
        <div class="table-container">
            <div class="table-responsive">
                <table class="table table-hover table-striped mb-0 align-middle" id="staffTable">
                    <thead class="table-header">
                        <tr>
                            <th class="px-3" style="width: 50px;">
                                <input type="checkbox" id="selectAllCheckbox" class="form-check-input">
                            </th>
                            <th class="px-3"><i class="fas fa-hashtag me-1"></i>ID</th>
                            <th class="px-3"><i class="fas fa-user me-1"></i>Staff Details</th>
                            <th class="px-3"><i class="fas fa-birthday-cake me-1"></i>Date of Birth</th>
                            <th class="px-3"><i class="fas fa-calendar-plus me-1"></i>Joining Date</th>
                            <th class="px-3"><i class="fas fa-info-circle me-1"></i>Status</th>
                            <th class="px-3 text-center table-actions"><i class="fas fa-cogs me-1"></i>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model != null && Model.Any())
                        {
                            foreach (var staff in Model)
                            {
                                <tr data-staff-id="@staff.StaffID">
                                    <td class="px-3">
                                        <input type="checkbox" class="form-check-input staff-checkbox" value="@staff.StaffID">
                                    </td>
                                    <td class="px-3">
                                        <span class="badge bg-primary fs-6">#@staff.StaffID</span>
                                    </td>
                                    <td class="px-3">
                                        <div class="d-flex align-items-center">
                                            <div class="staff-avatar">
                                                @(string.IsNullOrEmpty(staff.StaffName) ? "?" : staff.StaffName.Substring(0, 1).ToUpper())
                                            </div>
                                            <div>
                                                <div class="fw-bold text-primary">@(staff.StaffName != null ? staff.StaffName : "Unknown")</div>
                                                <small class="text-muted">Staff Member</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-3">
                                        <div class="text-muted">
                                            @if (!string.IsNullOrEmpty(staff.DOB))
                                            {
                                                <i class="fas fa-calendar me-1"></i>
                                                try {
                                                    @(DateTime.Parse(staff.DOB).Month + " " + DateTime.Parse(staff.DOB).Day + ", " + DateTime.Parse(staff.DOB).Year)
                                                } catch {
                                                    @staff.DOB
                                                }
                                            }
                                            else
                                            {
                                                <span class="text-muted">Not provided</span>
                                            }
                                        </div>
                                    </td>
                                    <td class="px-3">
                                        <div class="text-muted">
                                            @if (!string.IsNullOrEmpty(staff.DOJ))
                                            {
                                                <i class="fas fa-sign-in-alt me-1 text-success"></i>
                                                try {
                                                    @(DateTime.Parse(staff.DOJ).Month + " " + DateTime.Parse(staff.DOJ).Day + ", " + DateTime.Parse(staff.DOJ).Year)
                                                } catch {
                                                    @staff.DOJ
                                                }
                                            }
                                            else
                                            {
                                                <span class="text-muted">Not provided</span>
                                            }
                                        </div>
                                    </td>
                                    <td class="px-3">
                                        @if (staff.Status == "Active")
                                        {
                                            <span class="badge bg-success status-badge">Active</span>
                                        }
                                        else if (staff.Status == "Inactive")
                                        {
                                            <span class="badge bg-danger status-badge">Inactive</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-warning text-dark status-badge">@(staff.Status != null ? staff.Status : "Unknown")</span>
                                        }
                                    </td>
                                    <td class="px-3 text-center">
                                        <div class="btn-group" role="group">
                                            <button type="button" class="btn btn-outline-info btn-action"
                                                    onclick="viewStaff(@staff.StaffID)" title="View Details">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button type="button" class="btn btn-outline-warning btn-action"
                                                    onclick="editStaff(@staff.StaffID, '@staff.StaffName', '@staff.DOB', '@staff.DOJ', '@staff.Status')" title="Edit Staff">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button type="button" class="btn btn-outline-danger btn-action"
                                                    onclick="showDeleteConfirm(@staff.StaffID, '@staff.StaffName')" title="Delete Staff">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="7" class="text-center py-5">
                                    <div class="text-muted">
                                        <i class="fas fa-users fa-4x mb-3 text-secondary"></i>
                                        <h5>No Staff Members Found</h5>
                                        <p class="mb-0">No staff data available to display.</p>
                                        <button type="button" class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#addStaffModal">
                                            <i class="fas fa-plus me-1"></i>Add First Staff Member
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Total Staff</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">@Model.Count()</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-users fa-2x text-primary"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Active Staff</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">@Model.Count(s => s.Status == "Active")</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-user-check fa-2x text-success"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Inactive Staff</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">@Model.Count(s => s.Status != "Active")</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-user-times fa-2x text-warning"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">This Month Joiners</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">@Model.Count(s => s.DOJ != null && s.DOJ.Value.Month == DateTime.Now.Month)</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-user-plus fa-2x text-info"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Staff Table -->
    <div class="card border-0 shadow-sm">
        <div class="card-header bg-gradient-primary d-flex justify-content-between align-items-center">
            <h5 class="card-title text-white mb-0">
                <i class="fas fa-list me-2"></i>Staff List
                <span class="badge bg-light text-primary ms-2">@Model.Count() records</span>
            </h5>
            <div class="d-flex gap-2">
                <input type="text" id="searchStaff" class="form-control form-control-sm" placeholder="Search staff..." style="width: 200px;">
            </div>
        </div>
        
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover table-striped mb-0 align-middle" id="staffTable">
                    <thead class="table-dark">
                        <tr class="text-nowrap">
                            <th class="px-3">Staff</th>
                            <th class="px-3"><i class="fas fa-hashtag me-1"></i>ID</th>
                            <th class="px-3"><i class="fas fa-user me-1"></i>Name</th>
                            <th class="px-3"><i class="fas fa-birthday-cake me-1"></i>Date of Birth</th>
                            <th class="px-3"><i class="fas fa-calendar me-1"></i>Date of Joining</th>
                            <th class="px-3"><i class="fas fa-info-circle me-1"></i>Status</th>
                            <th class="px-3 text-center" style="min-width: 180px;"><i class="fas fa-cogs me-1"></i>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model != null && Model.Any())
                        {
                            foreach (var staff in Model)
                            {
                                <tr class="table-row" data-staff-id="@staff.StaffID">
                                    <td class="px-3">
                                        <div class="staff-avatar">
                                            @(staff.StaffName?.Substring(0, Math.Min(2, staff.StaffName.Length)).ToUpper())
                                        </div>
                                    </td>
                                    <td class="px-3">
                                        <span class="badge bg-primary">@staff.StaffID</span>
                                        <input type="hidden" class="edit-staff-id" value="@staff.StaffID" />
                                    </td>
                                    <td class="px-3">
                                        <div class="d-flex align-items-center">
                                            <div>
                                                <span class="display-mode fw-semibold">@staff.StaffName</span>
                                                <input type="text" class="form-control form-control-sm edit-mode d-none edit-staff-name" value="@staff.StaffName" />
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-3">
                                        <span class="display-mode text-muted">@(staff.DOB != null ? staff.DOB.Value.Day + "/" + staff.DOB.Value.Month + "/" + staff.DOB.Value.Year : "")</span>
                                        <input type="date" class="form-control form-control-sm edit-mode d-none edit-staff-dob" value="@(staff.DOB != null ? staff.DOB.Value.Year + "-" + staff.DOB.Value.Month.ToString().PadLeft(2, '0') + "-" + staff.DOB.Value.Day.ToString().PadLeft(2, '0') : "")" />
                                    </td>
                                    <td class="px-3">
                                        <span class="display-mode text-muted">@(staff.DOJ != null ? staff.DOJ.Value.Day + "/" + staff.DOJ.Value.Month + "/" + staff.DOJ.Value.Year : "")</span>
                                        <input type="date" class="form-control form-control-sm edit-mode d-none edit-staff-doj" value="@(staff.DOJ != null ? staff.DOJ.Value.Year + "-" + staff.DOJ.Value.Month.ToString().PadLeft(2, '0') + "-" + staff.DOJ.Value.Day.ToString().PadLeft(2, '0') : "")" />
                                    </td>
                                    <td class="px-3">
                                        <span class="display-mode">
                                            @if (staff.Status == "Active")
                                            {
                                                <span class="badge bg-success status-badge">@staff.Status</span>
                                            }
                                            else
                                            {
                                                <span class="badge bg-warning status-badge">@staff.Status</span>
                                            }
                                        </span>
                                        <select class="form-select form-select-sm edit-mode d-none edit-staff-status">
                                            <option value="Active" @(staff.Status == "Active" ? "selected" : "")>Active</option>
                                            <option value="Inactive" @(staff.Status == "Inactive" ? "selected" : "")>Inactive</option>
                                            <option value="Suspended" @(staff.Status == "Suspended" ? "selected" : "")>Suspended</option>
                                        </select>
                                    </td>
                                    <td class="px-3 text-center">
                                        <div class="action-buttons display-mode">
                                            <button type="button" class="btn btn-outline-info btn-action btn-sm me-1 edit-staff-btn" 
                                                    title="Edit Staff">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button type="button" class="btn btn-outline-primary btn-action btn-sm me-1" 
                                                    onclick="viewStaff(@staff.StaffID)" title="View Details">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button type="button" class="btn btn-outline-danger btn-action btn-sm" 
                                                    onclick="showDeleteConfirm(@staff.StaffID, '@staff.StaffName')" title="Delete Staff">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                        <div class="action-buttons edit-mode d-none">
                                            <button type="button" class="btn btn-success btn-action btn-sm me-1 save-staff-btn" 
                                                    title="Save Changes">
                                                <i class="fas fa-check"></i>
                                            </button>
                                            <button type="button" class="btn btn-secondary btn-action btn-sm cancel-staff-btn" 
                                                    title="Cancel Edit">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="7" class="text-center py-5">
                                    <div class="text-muted">
                                        <i class="fas fa-users fa-3x mb-3"></i>
                                        <h5>No Staff Found</h5>
                                        <p class="mb-0">No staff members available to display.</p>
                                        <small>Try adding new staff or adjusting your search criteria.</small>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteConfirmModalLabel">
                    <i class="fas fa-exclamation-triangle me-2"></i>Confirm Deletion
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="text-center">
                    <i class="fas fa-user-times fa-3x text-danger mb-3"></i>
                    <h5>Delete Staff Member</h5>
                    <p class="text-muted">Are you sure you want to delete <strong id="staffNameToDelete"></strong>?</p>
                    <p class="text-danger small">This action cannot be undone.</p>
                </div>
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-1"></i>Cancel
                </button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn" onclick="deleteStaff()">
                    <i class="fas fa-trash me-1"></i>Delete Staff
                </button>
                <input type="hidden" id="staffIdToDelete" />
            </div>
        </div>
    </div>
</div>

<!-- Add Staff Modal -->
<div class="modal fade" id="addStaffModal" tabindex="-1" aria-labelledby="addStaffModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="addStaffModalLabel">
                    <i class="fas fa-user-plus me-2"></i>Add New Staff Member
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addStaffForm">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="staffName" class="form-label">Staff Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="staffName" required>
                        </div>
                        <div class="col-md-6">
                            <label for="status" class="form-label">Status <span class="text-danger">*</span></label>
                            <select class="form-select" id="status" required>
                                <option value="">Select Status</option>
                                <option value="Active">Active</option>
                                <option value="Inactive">Inactive</option>
                                <option value="Pending">Pending</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="dob" class="form-label">Date of Birth</label>
                            <input type="date" class="form-control" id="dob">
                        </div>
                        <div class="col-md-6">
                            <label for="doj" class="form-label">Date of Joining</label>
                            <input type="date" class="form-control" id="doj">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-1"></i>Cancel
                </button>
                <button type="button" class="btn btn-primary" onclick="saveStaff()">
                    <i class="fas fa-save me-1"></i>Save Staff
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Staff Modal -->
<div class="modal fade" id="editStaffModal" tabindex="-1" aria-labelledby="editStaffModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title" id="editStaffModalLabel">
                    <i class="fas fa-user-edit me-2"></i>Edit Staff Member
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editStaffForm">
                    <input type="hidden" id="editStaffId">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="editStaffName" class="form-label">Staff Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="editStaffName" required>
                        </div>
                        <div class="col-md-6">
                            <label for="editStatus" class="form-label">Status <span class="text-danger">*</span></label>
                            <select class="form-select" id="editStatus" required>
                                <option value="Active">Active</option>
                                <option value="Inactive">Inactive</option>
                                <option value="Pending">Pending</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="editDob" class="form-label">Date of Birth</label>
                            <input type="date" class="form-control" id="editDob">
                        </div>
                        <div class="col-md-6">
                            <label for="editDoj" class="form-label">Date of Joining</label>
                            <input type="date" class="form-control" id="editDoj">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-1"></i>Cancel
                </button>
                <button type="button" class="btn btn-primary" onclick="updateStaff()">
                    <i class="fas fa-save me-1"></i>Update Staff
                </button>
            </div>
        </div>
    </div>
</div>

<script>
$(document).ready(function() {
    // Search functionality
    $('#searchStaff').on('keyup', function() {
        const value = $(this).val().toLowerCase();
        $('#staffTable tbody tr').filter(function() {
            $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
        });
    });

    // Edit staff functionality
    $('.edit-staff-btn').on('click', function() {
        const row = $(this).closest('tr');
        toggleEditMode(row, true);
    });

    $('.cancel-staff-btn').on('click', function() {
        const row = $(this).closest('tr');
        toggleEditMode(row, false);
        // Reset values to original
        resetRowValues(row);
    });

    $('.save-staff-btn').on('click', function() {
        const row = $(this).closest('tr');
        saveStaff(row);
    });
});

function toggleEditMode(row, editMode) {
    if (editMode) {
        row.addClass('edit-mode');
        row.find('.display-mode').addClass('d-none');
        row.find('.edit-mode').removeClass('d-none');
    } else {
        row.removeClass('edit-mode');
        row.find('.edit-mode').addClass('d-none');
        row.find('.display-mode').removeClass('d-none');
    }
}

function resetRowValues(row) {
    // Reset input values to original data attributes or spans
    // This would need to store original values when entering edit mode
}

function saveStaff(row) {
    const staffId = row.find('.edit-staff-id').val();
    const staffName = row.find('.edit-staff-name').val();
    const dob = row.find('.edit-staff-dob').val();
    const doj = row.find('.edit-staff-doj').val();
    const status = row.find('.edit-staff-status').val();

    const button = row.find('.save-staff-btn');
    const originalText = button.html();
    
    button.html('<span class="spinner-border spinner-border-sm me-1"></span>Saving...');
    button.prop('disabled', true);

    const userModel = `${staffId},${staffName},${dob},${doj},${status}`;

    $.ajax({
        url: '@Url.Action("EditStaff", "Staff")',
        data: { UserModel: userModel },
        type: 'GET',
        contentType: 'application/json; charset=utf-8',
        success: function(data) {
            if (data == 'Success') {
                // Update display values
                row.find('.display-mode .fw-semibold').text(staffName);
                row.find('.display-mode .text-muted').eq(0).text(formatDate(dob));
                row.find('.display-mode .text-muted').eq(1).text(formatDate(doj));
                
                const statusBadge = row.find('.display-mode .status-badge');
                statusBadge.removeClass('bg-success bg-warning bg-danger');
                statusBadge.addClass(status === 'Active' ? 'bg-success' : 'bg-warning');
                statusBadge.text(status);

                toggleEditMode(row, false);
                
                showAlert('Staff details updated successfully!', 'success');
            } else {
                showAlert('Failed to update staff details. Please try again.', 'danger');
            }
        },
        error: function() {
            showAlert('An error occurred while updating staff details.', 'danger');
        },
        complete: function() {
            button.html(originalText);
            button.prop('disabled', false);
        }
    });
}

function viewStaff(staffId) {
    window.location.href = '@Url.Action("StaffDetails", "Staff")' + '?id=' + staffId;
}

function showDeleteConfirm(staffId, staffName) {
    $('#staffIdToDelete').val(staffId);
    $('#staffNameToDelete').text(staffName);
    $('#deleteConfirmModal').modal('show');
}

function deleteStaff() {
    const staffId = $('#staffIdToDelete').val();
    const button = $('#confirmDeleteBtn');
    const originalText = button.html();
    
    button.html('<span class="spinner-border spinner-border-sm me-2"></span>Deleting...');
    button.prop('disabled', true);
    
    $.ajax({
        url: '@Url.Action("DeleteStaff", "Staff")',
        type: "POST",
        data: { id: staffId },
        success: function(result) {
            if (result.success) {
                $('#deleteConfirmModal').modal('hide');
                $(`tr[data-staff-id="${staffId}"]`).fadeOut(300, function() {
                    $(this).remove();
                    updateStatistics();
                });
                showAlert('Staff member deleted successfully!', 'success');
            } else {
                showAlert(result.message || 'Failed to delete staff member.', 'danger');
            }
        },
        error: function() {
            showAlert('An error occurred while deleting staff member.', 'danger');
        },
        complete: function() {
            button.html(originalText);
            button.prop('disabled', false);
        }
    });
}

function refreshTable() {
    location.reload();
}

function formatDate(dateString) {
    if (!dateString) return '';
    const date = new Date(dateString);
    return date.toLocaleDateString('en-GB');
}

function updateStatistics() {
    // Update the statistics cards after operations
    const totalStaff = $('#staffTable tbody tr:visible').length;
    $('.text-primary + .h5').text(totalStaff);
}

function showAlert(message, type) {
    const alertHtml = `
        <div class="alert alert-${type} alert-dismissible fade show position-fixed" 
             style="top: 20px; right: 20px; z-index: 9999; min-width: 300px;" role="alert">
            <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'} me-2"></i>
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>`;
    
    $('body').append(alertHtml);
    
    // Auto-dismiss after 5 seconds
    setTimeout(() => {
        $('.alert').fadeOut();
    }, 5000);
}

// Additional functions for modal functionality
function saveStaff() {
    const formData = {
        StaffName: $('#staffName').val(),
        DOB: $('#dob').val(),
        DOJ: $('#doj').val(),
        Status: $('#status').val()
    };
    
    // Validate required fields
    if (!formData.StaffName || !formData.Status) {
        showAlert('Please fill in all required fields.', 'warning');
        return;
    }
    
    $.ajax({
        url: '@Url.Action("CreateStaff_New", "Staff")',
        type: 'POST',
        data: formData,
        success: function(result) {
            if (result.success || result === 'Success') {
                $('#addStaffModal').modal('hide');
                showAlert('Staff created successfully!', 'success');
                setTimeout(function() {
                    location.reload();
                }, 1500);
            } else {
                showAlert('Failed to create staff. Please try again.', 'danger');
            }
        },
        error: function() {
            showAlert('An error occurred while creating staff.', 'danger');
        }
    });
}

function editStaff(staffId, staffName, dob, doj, status) {
    $('#editStaffId').val(staffId);
    $('#editStaffName').val(staffName);
    $('#editStatus').val(status);
    
    // Handle date formatting
    if (dob && dob !== 'Not provided') {
        try {
            const dobDate = new Date(dob);
            if (!isNaN(dobDate.getTime())) {
                $('#editDob').val(dobDate.toISOString().split('T')[0]);
            }
        } catch (e) {
            $('#editDob').val('');
        }
    }
    
    if (doj && doj !== 'Not provided') {
        try {
            const dojDate = new Date(doj);
            if (!isNaN(dojDate.getTime())) {
                $('#editDoj').val(dojDate.toISOString().split('T')[0]);
            }
        } catch (e) {
            $('#editDoj').val('');
        }
    }
    
    $('#editStaffModal').modal('show');
}

function updateStaff() {
    const staffData = {
        StaffID: $('#editStaffId').val(),
        StaffName: $('#editStaffName').val(),
        DOB: $('#editDob').val(),
        DOJ: $('#editDoj').val(),
        Status: $('#editStatus').val()
    };
    
    // Validate required fields
    if (!staffData.StaffName || !staffData.Status) {
        showAlert('Please fill in all required fields.', 'warning');
        return;
    }
    
    const userModel = staffData.StaffID + ',' + staffData.StaffName + ',' + 
                     (staffData.DOB || '') + ',' + (staffData.DOJ || '') + ',' + staffData.Status;
    
    $.ajax({
        url: '@Url.Action("EditStaff", "Staff")',
        type: 'GET',
        data: { UserModel: userModel },
        success: function(result) {
            if (result === 'Success') {
                $('#editStaffModal').modal('hide');
                showAlert('Staff updated successfully!', 'success');
                setTimeout(function() {
                    location.reload();
                }, 1500);
            } else {
                showAlert('Failed to update staff. Please try again.', 'danger');
            }
        },
        error: function() {
            showAlert('An error occurred while updating staff.', 'danger');
        }
    });
}

function viewStaff(staffId) {
    // Navigate to staff details page
    window.location.href = '@Url.Action("ViewStaff", "Staff")' + '?id=' + staffId;
}

function exportToExcel() {
    showAlert('Excel export functionality will be implemented soon.', 'info');
}

function printTable() {
    window.print();
}
</script>