@model  TestApp.VModels.Loans.LoanCols
@{
    ViewBag.Title = "MemberDetails";
    Layout = "~/Views/Shared/_LayoutPage.cshtml";
}
<html>
<head>
    <title>
        <h3>Loan Recovery</h3>
    </title>
    <script src="~/Scripts/jquery-1.11.1.min.js"></script>
    <script src="~/Scripts/bootstrap.min.js"></script>
    <link href="~/Scripts/Stylesheet.css" rel="stylesheet" />

    <meta charset="UTF-8">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js" type="text/javascript"></script>  
  <link rel='stylesheet prefetch' href='http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css'>
  <link rel='stylesheet prefetch' href='http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css'>
  <link rel='stylesheet prefetch' href='http://cdnjs.cloudflare.com/ajax/libs/jquery.bootstrapvalidator/0.5.0/css/bootstrapValidator.min.css'>
  <link rel="stylesheet" href="css/style.css">  
     <style>
         .drpdwn {
             width: 43px;
             height: 30px;
         }
     </style>
</head>
<body>
    @using (Html.BeginForm("LoansCols", "Loans", FormMethod.Post))
    {        
        <div class="container">   <h3>Loan Recovery</h3>
            <div style="float:left;margin-top: 1%;"> <label >Select Group Code&nbsp</label>@Html.DropDownListFor(x => Model.GrpCodeList, new SelectList(Model.GrpCodeList, "Value", "Text"), "--All Groups--", htmlAttributes: new { @class = "btn btn-primary",@style="width: 150px;", @id = "GrpCode" })&nbsp
            <label >Select Staff Name&nbsp</label>@Html.DropDownListFor(x => Model.StaffMbrList, new SelectList(Model.StaffMbrList, "Text", "Text"), "--All Staff--", htmlAttributes: new { @class = "btn btn-primary",@style="width: 150px;", @id = "StaffId" })&nbsp&nbsp
                 <label >Enter Member ID/Name &nbsp</label>@Html.TextBoxFor(x => Model.SrchQry, htmlAttributes: new { @class = "btn btn-primary",@style="width: 150px;", @id = "MbrIDName" })
       </div> <br /> <br /> <br /> 
            <div class="form-control" style="height:400px; overflow:auto;">
            <table class="table table-bordered table-hover">
                <thead>
                   <tr style="
    background-color: #428bca;
    color: #1b0a0a;
">
                        <th>Loan ID.
                        </th>
                        <th>Member Id
                        </th>
                        <th>Group Code.
                        </th>
                        <th>Staff Name
                        </th>
                        <th>Loan Amount
                        </th>
                        <th>Balance Amount
                        </th>
                        <th>Rate Of Interest
                        </th>
                        <th>Prin EMI
                        </th>
                        <th>Int EMI
                        </th>
                        <th>No Of Day
                        </th>
                        <th>Date Of Disbursement 
                        </th>
                        <th>Expiry Date 
                        </th>
                        <th>ALR Amt
                        </th>
                        <th>GRF Amt
                        </th>
                        <th>Processing Fee
                        </th>
                        <th>Stationary
                        </th>
                        <th>Insurance
                        </th>
                        <th>Other Income 
                        </th>
                        <th>Savings 
                        </th>
                        <th>Pre-Paid 
                        </th>
                        <th>Action 
                        </th>
                    </tr>
                </thead>
                <tbody class="tbody">
                </tbody>
            </table>
            </div><br />
</div>  
    }  
        
        
@*//-------- Loan Posting ---------------------------------------------------------------------------------------------------------*@
 
<div id="loanpoting" class="container"border-color: "darkgrey";border-width:"2px";"> 
     <label id="lblmgs"></label>
@using (Html.BeginForm("LoansCols", "Loans", FormMethod.Post, htmlAttributes: new { @id="LoanColaForm", @class = "well form-horizontal" }))
    {  
                    @Html.HiddenFor(model => model.LoanColId, new { @id = "LoanColId" })  
                    @Html.HiddenFor(model => model.MbrId, new { @id = "MbrId" })          
                    @Html.ValidationSummary(false, "", new { @id = "Errors", @class = "text-danger" }) 
         <fieldset>     
<!-- Form Name -->
<legend><h3><b>Loan Posting</b></h3></legend><br>

<!-- LoanID & Collected Amount-->
<div class="form-group">
  <label class="col-md-2 control-label">Loan ID</label>  
  <div class="col-md-3 inputGroupContainer">
  <div class="input-group">
  <span class="input-group-addon"><i class="glyphicon glyphicon-list"></i></span>
      @Html.TextBoxFor(x => x.LoanId, new { @class = "form-control",@readonly="readonly", @placeholder = "Loan Id", @required = "required", @id = "LoanId" })
    </div>
  </div>

    <!-- Collected Amount-->
  <label class="col-md-2 control-label" >Collected Amount</label> 
    <div class="col-md-3 inputGroupContainer">
    <div class="input-group">
  <span class="input-group-addon"><i class="glyphicon glyphicon-list"></i></span>
        @Html.TextBoxFor(model => model.Collected_Amount, new { @class = "form-control", @placeholder = "Collected Amount", @required = "required", @id = "Collected_Amount" })
    </div>
  </div>
</div>

    <!-- Prin Balance & Actual Balance-->
<div class="form-group">
  <label class="col-md-2 control-label" >Actual Balance</label> 
    <div class="col-md-3 inputGroupContainer">
    <div class="input-group">
  <span class="input-group-addon"><i class="glyphicon glyphicon-list"></i></span>
        @Html.TextBoxFor(model => model.Actual_Balance, new { @class = "form-control", @placeholder = "Actual_Balance", @required = "required", @id = "Actual_Balance" })
    </div>
  </div>

 <label class="col-md-2 control-label">Principal Balance</label>  
  <div class="col-md-3 inputGroupContainer">
  <div class="input-group">
  <span class="input-group-addon"><i class="glyphicon glyphicon-list"></i></span>
       @Html.TextBoxFor(model => model.Prin_Balance, new { @class = "form-control", @placeholder = "Prin Balance", @required = "required", @id = "Prin_Balance" })
    </div>
  </div>    
</div>
   
<!-- Int EMI & Prin Collected-->
<div class="form-group">
  <label class="col-md-2 control-label">Interest Collected</label>
    <div class="col-md-3 selectContainer">
    <div class="input-group">
               <span class="input-group-addon"><i class="glyphicon glyphicon-list"></i></span>
          @Html.TextBoxFor(model => model.Int_Collect, new { @class = "form-control", @placeholder = "Int_Collect", @required = "required", @id = "Int_Collect" })
  </div>
</div>
    <label class="col-md-2 control-label">Principal Collected</label>  
  <div class="col-md-3 inputGroupContainer">
  <div class="input-group">
  <span class="input-group-addon"><i class="glyphicon glyphicon-list"></i></span>
       @Html.TextBoxFor(model => model.Prin_Collected, new { @class = "form-control", @placeholder = "Prin Collected", @required = "required", @id = "Prin_Collected" })
    </div>
  </div>
</div>

<!-- Int_EMI & Balance_Interest-->
<div class="form-group">  
  <label class="col-md-2 control-label">Balance Installment</label>
    <div class="col-md-3 selectContainer">
    <div class="input-group">
               <span class="input-group-addon"><i class="glyphicon glyphicon-list"></i></span>
          @Html.TextBoxFor(model => model.Balance_Installment, new { @class = "form-control", @placeholder = "Balance_Installment", @required = "required", @id = "Balance_Installment" })
  </div>
</div>
      <label class="col-md-2 control-label">Balance Interest</label>  
  <div class="col-md-3 inputGroupContainer">
  <div class="input-group">
  <span class="input-group-addon"><i class="glyphicon glyphicon-list"></i></span>
       @Html.TextBoxFor(model => model.Balance_Interest, new { @class = "form-control", @placeholder = "Balance Interest", @required = "required", @id = "Balance_Interest" })
    </div>
  </div>
  </div>

<!--  Prin_Due & Int_Due-->
<div class="form-group">
  <label class="col-md-2 control-label">Principal Due</label>
    <div class="col-md-3 selectContainer">
    <div class="input-group">
               <span class="input-group-addon"><i class="glyphicon glyphicon-list"></i></span>
          @Html.TextBoxFor(model => model.Prin_Due, new { @class = "form-control", @placeholder = "Prin Due", @required = "required", @id = "Prin_Due" })
  </div>
</div>
<label class="col-md-2 control-label">Interest Due</label>  
    <div class="col-md-3 inputGroupContainer">
    <div class="input-group">
        <span class="input-group-addon"><i class="glyphicon glyphicon-list"></i></span>
      @Html.TextBoxFor(model => model.Int_Due, new { @class = "form-control", @placeholder = "Int Due", @required = "required", @id = "Int_Due" })
    </div>
  </div>
  </div>

<!-- Transact_Date & Next Due Date-->
<div class="form-group">
  <label class="col-md-2 control-label" >Transact Date</label> 
    <div class="col-md-3 inputGroupContainer">
    <div class="input-group">
  <span class="input-group-addon"><i class="glyphicon glyphicon-list"></i></span>&nbsp
        @Html.DropDownListFor(x => Model.TD,Enumerable.Range(1,31).Select(i=> new SelectListItem {Value=i.ToString(),Text=i.ToString()}), "DD", htmlAttributes: new { @class = "drpdwn", @id = "TD" })&nbsp&nbsp;
         @Html.DropDownListFor(x => Model.TM, Enumerable.Range(1,12).Select(i=> new SelectListItem {Value=i.ToString(),Text=i.ToString()}), "MM", htmlAttributes: new { @class = "drpdwn", @id = "TM" })&nbsp&nbsp;
         @Html.DropDownListFor(x => Model.TY, Enumerable.Range(2015, Convert.ToInt32(DateTime.Now.Year-2015+1)).Select(i=> new SelectListItem {Value=i.ToString(),Text=i.ToString()}), "YYYY", htmlAttributes: new { @class = "drpdwn", @id = "TY" })
    </div>
  </div>
      <label class="col-md-2 control-label" >Next Due Date</label> 
    <div class="col-md-3 inputGroupContainer">
    <div class="input-group">
  <span class="input-group-addon"><i class="glyphicon glyphicon-list"></i></span>&nbsp
        @Html.DropDownListFor(x => Model.NxtDueD,Enumerable.Range(1,31).Select(i=> new SelectListItem {Value=i.ToString(),Text=i.ToString()}), "DD", htmlAttributes: new { @class = "drpdwn", @id = "ND" })&nbsp&nbsp;
         @Html.DropDownListFor(x => Model.NxtDueM, Enumerable.Range(1,12).Select(i=> new SelectListItem {Value=i.ToString(),Text=i.ToString()}), "MM", htmlAttributes: new { @class = "drpdwn", @id = "NM" })&nbsp&nbsp;
         @Html.DropDownListFor(x => Model.NxtDueY, Enumerable.Range(2015, Convert.ToInt32(DateTime.Now.Year-2015+1)).Select(i=> new SelectListItem {Value=i.ToString(),Text=i.ToString()}), "YYYY", htmlAttributes: new { @class = "drpdwn", @id = "NY" })
    </div>
  </div>
</div>

    <!--Upto_Last_Savings-->
<div class="form-group">
  <label class="col-md-2 control-label">Total Savings</label>  
    <div class="col-md-3 inputGroupContainer">
    <div class="input-group">
        <span class="input-group-addon"><i class="glyphicon glyphicon-list"></i></span>
      @Html.TextBoxFor(model => model.Upto_Last_Savings, new { @class = "form-control", @placeholder = "Upto_Last_Savings", @required = "required", @id = "Upto_Last_Savings" })
    </div>
  </div>

    <!--During_Savings-->
  <label class="col-md-2 control-label">Today Savings</label>  
    <div class="col-md-3 inputGroupContainer">
    <div class="input-group">
        <span class="input-group-addon"><i class="glyphicon glyphicon-envelope"></i></span>
      @Html.TextBoxFor(model => model.During_Savings, new { @class = "form-control", @placeholder = "During Savings", @required = "required", @id = "During_Savings" })
    </div>
  </div>
</div>

       <!-- As_On -->
<div class="form-group"> 
  <label class="col-md-2 control-label">As On</label>
    <div class="col-md-3 selectContainer">
    <div class="input-group">
               <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
          @Html.TextBoxFor(model => model.As_On, new { @class = "form-control", @placeholder = "As On", @required = "required", @id = "As_On" })
  </div>
</div>

           <!-- Adjustment -->
  <label class="col-md-2 control-label">Adjustment</label>
    <div class="col-md-3 selectContainer">
    <div class="input-group">
               <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
          @Html.TextBoxFor(model => model.Adjustment, new { @class = "form-control", @placeholder = "Adjustment", @required = "required", @id = "Adjustment" })
  </div>
</div>
</div>

<!-- Success message -->
<label class="alert alert-success" style="display:none" role="alert" id="success_message"> <i class="glyphicon glyphicon-thumbs-up"></i> Success!.</label>
    
<!-- Button -->
<div class="form-group">
  <label class="col-md-4 control-label"></label>
  <div class="col-md-4 inputGroupContainer">
      <input type="submit" style="float:left" id="btnSave" class="btn btn-warning" value="Submit"/>&nbsp&nbsp&nbsp
      <input type="button" value="Cancel" id="btnCancel" class="btn btn-warning" style="float:right" />
  </div>
</div>
</fieldset>  
      }
  <!-- /.container -->
  <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
<script src='http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js'></script>
<script src='http://cdnjs.cloudflare.com/ajax/libs/bootstrap-validator/0.4.5/js/bootstrapvalidator.min.js'></script>
<script  src="js/index.js"></script>
</div>  
</body>
</html>

<script type="text/javascript">
    //Load Data in Table when documents is read

    $(document).ready(function () {
        loadData();
        $("#loanpoting").hide();

        //$("#loanpoting").dialog({
        //    autoOpen: false,
        //    resizable: false,
        //    width: 500,
        //    height: 600,
        //    modal: true,
        //    buttons: {
        //        OK: function () {
        //            $("#LoanColaForm").submit();  // our log-out function goes here
        //        },
        //        Cancel: function () {
        //            $(this).dialog("close");
        //        }
        //    }
        //});
    });

    $("#GrpCode").change(function () {
        loadData();
    });
    $("#StaffId").change(function () {
        loadData();
    });

    $("#MbrIDName").keyup(function () {
        loadData();
    });

   

    //Load Data function
    function loadData() {
        var selectedGrpCode = $("#GrpCode :selected").text();
        var vStaffId = $("#StaffId").val();
        var vMbrId = $("#MbrIDName").val();
        $.ajax({
            url: '@Url.Action("LoansList","Loans")',
            type: "GET",
            contentType: "application/json;charset=utf-8",
            async: true,
            data: { sGrpCode: selectedGrpCode, sStaffName: vStaffId, sMbrSrch: vMbrId },
            catch: false,
            dataType: "json",
            success: function (result) {

                var html = '';
                $.each(result, function (key, item) {
                    html += '<tr>';
                    html += '<td>' + item.LoanID + '</td>';
                    html += '<td>' + item.MbrId + '</td>';
                    html += '<td>' + item.GrpCode + '</td>';
                    html += '<td>' + item.StaffName + '</td>';
                    html += '<td>' + item.Loan_Amount + '</td>';
                    html += '<td>' + item.Balance_Amount + '</td>';
                    html += '<td>' + item.RateOfInterest + '</td>';
                    html += '<td>' + item.Prin_EMI + '</td>';
                    html += '<td>' + item.Int_EMI + '</td>';
                    html += '<td>' + item.NoOfDay + '</td>';
                    html += '<td>' + item.Date_Of_Disbursement + '</td>';

                    html += '<td>' + item.Expiry_Date + '</td>';
                    html += '<td>' + item.ALRAmt + '</td>';
                    html += '<td>' + item.GRFAmt + '</td>';
                    html += '<td>' + item.Processing_Fee + '</td>';
                    html += '<td>' + item.Stationary + '</td>';
                    html += '<td>' + item.Insurance + '</td>';
                    html += '<td>' + item.Other_Income + '</td>';
                    html += '<td>' + item.Savings + '</td>';
                    html += '<td><input type="checkbox" /></td>';
                    html += '<td><a href="#" onclick="return getbyID(' + item.LoanID + ')">Post</a> | <a href="#" onclick="Delete(' + item.LoanID + ')">Delete</a></td>';
                    html += '</tr>';
                });
                $('.tbody').html(html);
            },
            error: function (errormessage) {
                alert(errormessage.responseText);
            }
        });
    }


    //Function for getting the Data Based upon Employee ID
    function getbyID(EmpID) {
        $("#loanpoting").show();
        $('html, body').animate({ scrollTop: $(document).height() }, 'smooth');    

        var selectedRow;
       
            $('tr').removeClass('selected');
            $(this).addClass('selected');

            var td = $('tr').children('td');
            var oFormObject = document.forms['LoanColaForm'];
            for (var i = 0; i < td.length; ++i) {
                switch (i) {
                    case 3:
                        oFormObject.elements[3].value = td.eq(0).text();
                        break;
                    case 4:
                        oFormObject.elements[4].value = td.eq(i).text();
                        break;
                    case 5:
                        oFormObject.elements[5].value = td.eq(i).text();
                        break;
                    case 6:
                        oFormObject.elements[6].value = td.eq(i).text();
                        break;
                    case 7:
                        oFormObject.elements[7].value = td.eq(i).text();
                        break;
                    case 8:
                        oFormObject.elements[8].value = td.eq(i).text();
                        break;
                    case 9:
                        oFormObject.elements[9].value = td.eq(i).text();
                        break;
                    case 10:
                        oFormObject.elements[10].value = td.eq(i).text();
                        break;
                    case 11:
                        oFormObject.elements[11].value = td.eq(i).text();
                        break;
                    case 12:
                        oFormObject.elements[12].value = td.eq(i).text();
                        break;
                    case 13:
                        oFormObject.elements[13].value = td.eq(i).text();
                        break;
                    case 14:
                        oFormObject.elements[14].value = td.eq(i).text();
                        break;
                    case 15:
                        oFormObject.elements[15].value = td.eq(i).text();
                        break;
                    case 16:
                        oFormObject.elements[16].value = td.eq(i).text();
                        break;
                    case 17:
                        oFormObject.elements[17].value = td.eq(i).text();
                        break;
                    case 18:
                        oFormObject.elements[18].value = td.eq(i).text();
                        break;
                    case 19:
                        oFormObject.elements[19].value = td.eq(i).text();
                        break;
                    case 20:
                        oFormObject.elements[20].value = td.eq(i).text();
                        break;
                    case 21:
                        oFormObject.elements[21].value = td.eq(i).text();
                        break;
                    case 22:
                        oFormObject.elements[22].value = td.eq(i).text();
                        break;                    
                }

                //var vVal = td.eq(i).text(); 
                //var oformElement = oFormObject.elements[i];
                //oFormObject.elements[i].value = td.eq(i).text();
            }
       
        return false;
    }



    //function for deleting employee's record
    function Delete(ID) {
        var ans = confirm("Are you sure you want to delete this record?");
        if (ans) {
            $.ajax({
                url: '@Url.Action("RemoveLoan","Loans")',
                type: "Get",
                contentType: "application/json;charset=utf-8",
                async: true,
                data: { iLoanID: ID },
                catch: false,
                success: function (result) {
                    loadData();
                },
                error: function (errormessage) {
                    alert(errormessage.responseText);
                }
            });
        }
    }
</script>


