@model TestApp.VModels.Group.Groups
@{
    ViewBag.Title = "Edit Group";
    Layout = "~/Views/Shared/_LayoutPage.cshtml";
}

<div class="container-fluid">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="h3 mb-0 text-warning fw-bold">
            <i class="fas fa-edit me-2"></i>Edit Group
        </h2>
        <a href="@Url.Action("GrpList_New", "Group")" class="btn btn-outline-secondary">
            <i class="fas fa-list me-2"></i>Back to Groups
        </a>
    </div>

    <!-- Success/Error Messages -->
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle me-2"></i>@TempData["Success"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i>@TempData["Error"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <!-- Edit Form Card -->
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-warning text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-users me-2"></i>Group Information
                    </h5>
                </div>
                <div class="card-body p-4">
                    @using (Html.BeginForm("EditGroup_New", "Group", FormMethod.Post, new { @class = "needs-validation", @id = "groupEditForm", @novalidate = "novalidate" }))
                    {
                        @Html.Hidden("GroupID", ViewBag.GroupID)
                        
                        <div class="row g-4">
                            <!-- Group Name -->
                            <div class="col-12">
                                <label class="form-label fw-semibold">Group Name <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-layer-group text-warning"></i>
                                    </span>
                                    @Html.TextBoxFor(model => model.GroupName, new { 
                                        @class = "form-control", 
                                        @placeholder = "Enter group name", 
                                        @required = "required", 
                                        @id = "GroupName" 
                                    })
                                </div>
                                <div class="invalid-feedback">Please enter a group name.</div>
                            </div>

                            <!-- Group Type -->
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Group Type <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-tags text-warning"></i>
                                    </span>
                                    @Html.DropDownListFor(model => model.GroupType, new SelectList(new[] {
                                        new { Value = "", Text = "-- Select Group Type --" },
                                        new { Value = "Self Help Group", Text = "Self Help Group" },
                                        new { Value = "Joint Liability Group", Text = "Joint Liability Group" },
                                        new { Value = "Individual", Text = "Individual" },
                                        new { Value = "Community Group", Text = "Community Group" }
                                    }, "Value", "Text"), new { @class = "form-select", @required = "required" })
                                </div>
                                <div class="invalid-feedback">Please select a group type.</div>
                            </div>

                            <!-- Group Code -->
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Group Code</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-hashtag text-warning"></i>
                                    </span>
                                    @Html.TextBoxFor(model => model.GroupCode, new { 
                                        @class = "form-control", 
                                        @placeholder = "Group code", 
                                        @id = "GroupCode",
                                        @readonly = "readonly" 
                                    })
                                </div>
                                <div class="form-text">Group code cannot be changed</div>
                            </div>

                            <!-- Status -->
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Status <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-toggle-on text-warning"></i>
                                    </span>
                                    @Html.DropDownListFor(model => model.Status, new SelectList(new[] {
                                        new { Value = "", Text = "-- Select Status --" },
                                        new { Value = "Active", Text = "Active" },
                                        new { Value = "Inactive", Text = "Inactive" },
                                        new { Value = "Suspended", Text = "Suspended" }
                                    }, "Value", "Text"), new { @class = "form-select", @required = "required" })
                                </div>
                                <div class="invalid-feedback">Please select group status.</div>
                            </div>

                            <!-- Recovery Day -->
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Recovery Day</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-calendar text-warning"></i>
                                    </span>
                                    @Html.DropDownListFor(model => model.RecoveryDay, new SelectList(new[] {
                                        new { Value = "", Text = "-- Select Day --" },
                                        new { Value = "Monday", Text = "Monday" },
                                        new { Value = "Tuesday", Text = "Tuesday" },
                                        new { Value = "Wednesday", Text = "Wednesday" },
                                        new { Value = "Thursday", Text = "Thursday" },
                                        new { Value = "Friday", Text = "Friday" },
                                        new { Value = "Saturday", Text = "Saturday" },
                                        new { Value = "Sunday", Text = "Sunday" }
                                    }, "Value", "Text"), new { @class = "form-select" })
                                </div>
                            </div>

                            <!-- Village/Location -->
                            <div class="col-12">
                                <label class="form-label fw-semibold">Village/Location <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-map-marker-alt text-warning"></i>
                                    </span>
                                    @Html.TextBoxFor(model => model.Village, new { 
                                        @class = "form-control", 
                                        @placeholder = "Enter village/location", 
                                        @required = "required" 
                                    })
                                </div>
                                <div class="invalid-feedback">Please enter village/location.</div>
                            </div>

                            <!-- Meeting Place Address -->
                            <div class="col-12">
                                <label class="form-label fw-semibold">Meeting Place Address</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-home text-warning"></i>
                                    </span>
                                    @Html.TextAreaFor(model => model.MeetingPlaceAddress, new { 
                                        @class = "form-control", 
                                        @rows = "3", 
                                        @placeholder = "Enter meeting place address" 
                                    })
                                </div>
                            </div>

                            <!-- Total Members -->
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Total Members</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-users text-warning"></i>
                                    </span>
                                    @Html.TextBoxFor(model => model.TotalMember, new { 
                                        @class = "form-control", 
                                        @type = "number", 
                                        @min = "0", 
                                        @placeholder = "Number of members" 
                                    })
                                </div>
                            </div>

                            <!-- Distance -->
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Distance (km)</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-road text-warning"></i>
                                    </span>
                                    @Html.TextBoxFor(model => model.Distance, new { 
                                        @class = "form-control", 
                                        @type = "number", 
                                        @min = "0", 
                                        @placeholder = "Distance in km" 
                                    })
                                </div>
                            </div>

                            <!-- Staff ID -->
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Staff ID</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-user-tie text-warning"></i>
                                    </span>
                                    @Html.TextBoxFor(model => model.StaffID, new { 
                                        @class = "form-control", 
                                        @type = "number", 
                                        @placeholder = "Assigned staff ID" 
                                    })
                                </div>
                            </div>

                            <!-- Formed By -->
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Formed By</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-user text-warning"></i>
                                    </span>
                                    @Html.TextBoxFor(model => model.FormedBy, new { 
                                        @class = "form-control", 
                                        @placeholder = "Group founder name" 
                                    })
                                </div>
                            </div>

                            <!-- DOC -->
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Date of Creation</label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-calendar-plus text-warning"></i>
                                    </span>
                                    @Html.TextBoxFor(model => model.DOC, new { 
                                        @class = "form-control", 
                                        @placeholder = "Date of creation" 
                                    })
                                </div>
                            </div>

                            <!-- Form Actions -->
                            <div class="col-12">
                                <hr class="my-4">
                                <div class="d-flex justify-content-end gap-3">
                                    <a href="@Url.Action("GrpList_New", "Group")" class="btn btn-outline-secondary">
                                        <i class="fas fa-times me-2"></i>Cancel
                                    </a>
                                    <button type="submit" class="btn btn-warning btn-lg" id="submitBtn">
                                        <i class="fas fa-save me-2"></i>Update Group
                                    </button>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Success/Error Messages -->
    <div id="messageContainer" class="mt-3"></div>
</div>

<script>
$(document).ready(function() {
    // Initialize form validation
    initializeFormValidation();
    
    // Form submission handling
    $('#groupEditForm').on('submit', function(e) {
        e.preventDefault();
        if (this.checkValidity()) {
            submitForm();
        } else {
            e.stopPropagation();
            this.classList.add('was-validated');
        }
    });
});

function initializeFormValidation() {
    // Real-time validation
    $('.form-control, .form-select').on('input change', function() {
        if (this.checkValidity()) {
            this.classList.remove('is-invalid');
            this.classList.add('is-valid');
        } else {
            this.classList.remove('is-valid');
            this.classList.add('is-invalid');
        }
    });
    
    // Custom validation for group name
    $('#GroupName').on('input', function() {
        const value = this.value.trim();
        if (value.length < 3) {
            this.setCustomValidity('Group name must be at least 3 characters long');
        } else if (value.length > 50) {
            this.setCustomValidity('Group name must not exceed 50 characters');
        } else {
            this.setCustomValidity('');
        }
    });
}

function submitForm() {
    const button = $('#submitBtn');
    const originalText = button.html();
    
    // Show loading state
    button.html('<span class="spinner-border spinner-border-sm me-2"></span>Updating Group...');
    button.prop('disabled', true);
    
    // Submit the form normally (not AJAX for now)
    document.getElementById('groupEditForm').submit();
}

function showMessage(message, type) {
    const alertClass = type === 'success' ? 'alert-success' : 'alert-danger';
    const icon = type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-triangle';
    
    const alert = `
        <div class="alert ${alertClass} alert-dismissible fade show" role="alert">
            <i class="${icon} me-2"></i>${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    `;
    
    $('#messageContainer').html(alert);
    
    // Auto-dismiss after 5 seconds for success messages
    if (type === 'success') {
        setTimeout(function() {
            $('.alert').fadeOut();
        }, 5000);
    }
    
    // Scroll to message
    $('html, body').animate({
        scrollTop: $('#messageContainer').offset().top - 100
    }, 500);
}
</script>